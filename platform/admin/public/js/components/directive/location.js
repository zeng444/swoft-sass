(function(){"use strict";function a(a){if(/^\d+$/.test(a)){return a+"px"}return a}Vue.component("i-location-input",Janfish.extend({props:["value","width","height","placeholder","panControl","zoomControl","zoom","defaultPosition"],data:function(){return{map:"",selectedMarker:"",searchMarker:[],searchVal:"",searchService:""}},watch:{value:function(a){if(!a){return false}var b=this.syncIn(a);if(this.selectedMarker){this.selectedMarker.setMap(null)}this.selectedMarker=new qq.maps.Marker({position:new qq.maps.LatLng(b[0],b[1]),map:this.map});this.map.setCenter(new qq.maps.LatLng(b[0],b[1]))}},render:function(b){var c=this,d={height:"350px",width:"100%"};if(this.height){d.height=a(this.height)}if(this.width){d.width=a(this.width)}return b("Row",{},[b("i-input",{on:{input:function(a){c.$emit("input",a)}},style:{marginBottom:"15px"},props:{value:c.value,placeholder:this.placeholder}}),b("div",{attrs:{class:"map"},style:d},[b("div",{style:{display:"flex",padding:"8px",position:"absolute",left:0,top:0,zIndex:1,width:"100%",backgroundColor:"rgba(0,0,0,.2)"}},[b("input",{style:{marginRight:"10px",height:"32px",display:"inline-block",width:"100%",border:"1px solid #dddee1",backgroundColor:"#fff",color:"#495060",cursor:"text",padding:"4px 7px",lineHeight:"1.5",borderRadius:"4px"},attrs:{placeholder:'请输入带有城市名的地址 如:e.g:"成都方糖小镇"',value:c.searchVal},on:{input:function(a){c.searchVal=a.target.value}}}),b("i-button",{props:{type:"primary"},on:{click:function(){c.searchMap(c.searchVal)}}},"搜索")])])])},methods:{syncIn:function(a){return a.split(",")},sync:function(a,b){this.$emit("input",a+","+b)},searchMap:function(a){this.searchService.setPageIndex(0);this.searchService.setPageCapacity(10);this.searchService.search(a)},initMap:function(){var a=this,b=this.$el.getElementsByClassName("map"),c=new qq.maps.LatLng(30.65742,104.06584);if(this.defaultPosition){this.defaultPosition=this.defaultPosition.split(",");c=new qq.maps.LatLng(this.defaultPosition[0],this.defaultPosition[1])}this.zoom=this.zoom===undefined?12:this.zoom;this.map=new qq.maps.Map(b[0],{zoom:this.zoom,mapTypeControl:false,zoomControl:this.zoomControl,panControl:this.panControl,zoomControlOptions:{position:qq.maps.ControlPosition.RIGHT_BOTTOM},panControlOptions:{position:qq.maps.ControlPosition.RIGHT_BOTTOM},center:c});qq.maps.event.addListener(this.map,"click",function(b){var c=b.latLng.getLat().toFixed(6),d=b.latLng.getLng().toFixed(6);a.value=c+","+d;a.sync(c,d)});a.searchService=new qq.maps.SearchService({error:function(b){a.$Message.error("出错了")},complete:function(b){if(b.type!=="POI_LIST"){a.$Message.error('请附带城市信息比如:"成都方糖小镇"');return false}var c,d,e,f=new qq.maps.LatLngBounds,g=b.detail.pois,h;while(h=a.searchMarker.pop()){h.setMap(null)}for(d=0,e=g.length;d<e;d++){c=g[d];f.extend(c.latLng);a.searchMarker[d]=new qq.maps.Marker({map:a.map});a.searchMarker[d].setPosition(c.latLng);a.searchMarker[d].setTitle(c.name);(function(b){qq.maps.event.addListener(a.searchMarker[d],"click",function(){var c=b.latLng.lat.toFixed(6),d=b.latLng.lng.toFixed(6);a.value=c+","+d;a.sync(c,d)})})(c)}a.map.fitBounds(f)}})}},mounted:function(){this.$nextTick(function(){this.initMap()})}}))})();