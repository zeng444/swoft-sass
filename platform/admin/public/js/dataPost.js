(function(){"use strict";var a;a=Janfish.extend({data:function(){return{successTips:"提交成功",api:{post:""},formData:{},validation:{},postMode:false,isNew:false}},methods:{uploadSuccess:function(a){if(a.code!="200"){this.$Message.error(a.message);return false}this.formData[a.data.field]=a.data.data[0].name},dataLoad:function(a){var b=this,c,d=b.api.post.indexOf("?")?"&":"?";b.$http.get(b.api.post+d+"id="+encodeURI(a)).then(function(a){if(a.status!=="success"){b.$Message.error(a.message);return false}c=b.formatLoadedData(a.data.data);b.formData=b.afterLoad(c);b.formLoaded=true})},formatLoadedData:function(a){var b,c;for(b in this.validation){for(c=0;c<this.validation[b].length;c++){if(this.validation[b][c].type&&(this.validation[b][c].type.toLowerCase()=="integer"||this.validation[b][c].type.toLowerCase()=="number")){a[b]=Number(a[b])}}}return a},afterPost:function(a){location.href="/"+this.api.post.split("/")[1]},afterLoad:function(a){return a},beforePost:function(a){return a},handleSubmit:function(a){var b=this;b.$refs[a].validate(function(a){if(a){b.$http.post(b.api.post,qs.stringify(b.beforePost(b.formData))).then(function(a){if(a.status!=="success"){b.$Message.error(a.message);return false}b.$Message.success(b.successTips);b.afterPost(a.data)})}else{b.$Message.error("表单验证失败!")}})},handleReset:function(a){this.$refs[a].resetFields()}},mounted:function(){var a=this;if(!a.purl.param.id){a.isNew=true}if(a.postMode===false){a.dataLoad(a.purl.param.id)}}});window.Janfish_DataPost=a})();