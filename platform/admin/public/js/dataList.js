(function(){"use strict";var a,b;a=Janfish.extend({data:function(){return{api:{search:"",remove:""},primaryId:"id",showPost:false,formData:{},showPreview:false,previewData:{},selections:[],count:0,page:1,pageSize:10,searchFilter:{},sortRule:"",columns:[],data:[]}},methods:{handleSubmit:function(a){var b=this;if(b.formLoaded===false){return false}b.$refs[a].validate(function(c){if(c){b.$http.post(b.api.post,qs.stringify(b.beforePost(b.formData))).then(function(c){if(c.status!=="success"){b.$Message.error(c.message);return false}b.$Message.success("提交成功");b.afterPost(c.data);b.handleReset(a);b.loadList(1,b.pageSize)})}else{b.$Message.error("表单验证失败!")}})},handleReset:function(a){for(var b in this.formData){this.formData[b]=""}if(this.showPost){this.showPost=false}this.formLoaded=false;this.$refs[a].resetFields()},openPostModal:function(a){var b=this,c,d=b.api.post.indexOf("?")?"&":"?";b.$http.get(b.api.post+d+"id="+encodeURI(a||"")).then(function(a){if(a.status!=="success"){b.$Message.error(a.message);return false}c=b.formatLoadedData(a.data.data);b.formData=b.afterLoad(c);b.formLoaded=true});this.showPost=true},displayImg:function(a,b){return a("img",{attrs:{src:b},style:{width:"45px",margin:"5px 0"}})},displayPreview:function(a){this.previewData=a;this.showPreview=!this.showPreview},afterPost:function(a){},afterLoad:function(a){return a},beforePost:function(a){return a},formatLoadedData:function(a){var b,c;for(b in this.validation){for(c=0;c<this.validation[b].length;c++){if(this.validation[b][c].type&&(this.validation[b][c].type.toLowerCase()=="integer"||this.validation[b][c].type.toLowerCase()=="number")){a[b]=Number(a[b])}}}return a},modifyRemoteData:function(a){var b=this;b.$http.post(b.api.post,qs.stringify(a)).then(function(a){if(a.status!=="success"){b.$Message.error(a.message);return false}b.$Message.success("操作成功")})},remoteSort:function(a){if(a.order==="normal"){this.sortRule=""}else{this.sortRule=a.order==="desc"?"-"+a.key:a.key}this.loadList(1,this.pageSize)},selectionChange:function(a){this.selections=a},resetFilter:function(){for(b in this.searchFilter){this.searchFilter[b]=""}},afterDataLoad:function(a){return a},listPostData:function(a){return a},loadList:function(a,b){var c=this,d;c.page=a;c.pageSize=b;c.searchFilter.page=a;c.searchFilter.pageSize=b;d=c.api.search;if(c.sortRule){d+=(/\?/.test(c.api.search)?"&":"?")+"sort="+encodeURI(c.sortRule)}c.$http.post(d,qs.stringify(c.listPostData(c.searchFilter))).then(function(a){if(a.code!=="200"){c.$Message.error(a.message);return false}var b=c.afterDataLoad(a.data);c.data=b.data;c.count=b.count})},pageChange:function(a){this.loadList(a,this.pageSize)},sizeChange:function(a){this.pageSize=a;this.loadList(1,this.pageSize)},remoteBehavior:function(a,b,c){c=c||"您确定要操作Id为 {{id}} 的记录吗";var d=this;if(!d.api[a]){console.info("remoteBehavior 没有定义接口行为");return false}this.$Modal.confirm({title:"提示信息",content:c.replace("{{id}}","<strong>"+b+"</strong>"),onOk:function(){d.$http.post(d.api[a],qs.stringify({id:b})).then(function(a){if(a.code!=="200"){d.$Message.error(a.message);return false}d.$Message.success("操作成功");d.loadList(d.page,d.pageSize)})},onCancel:function(){return false}})},batchRemoteBehavior:function(a,c){c=c||"您确定要操作Id为 {{id}} 的记录吗";var d=this,e=[];if(!d.api[a]){console.info("remoteBehavior 没有定义接口行为");return false}if(d.selections.length==0){d.$Message.error("你没有任何选择");return false}for(b in d.selections){e.push(d.selections[b][d.primaryId])}this.$Modal.confirm({title:"提示信息",content:c.replace("{{id}}","<strong>"+e.join("</strong>,<strong>")+"</strong>"),onOk:function(){d.$http.post(d.api[a],qs.stringify({id:e.join(",")})).then(function(a){if(a.code!=="200"){d.$Message.error(a.message);return false}d.selections=[];d.$Message.success("操作成功");d.loadList(d.page,d.pageSize)})},onCancel:function(){return false}})},remove:function(a){this.remoteBehavior("remove",a,"您确定要删除Id为 {{id}} 的记录吗")},removeBatch:function(){this.batchRemoteBehavior("remove","您确定要删除Id为 {{id}} 的记录吗")}},mounted:function(){this.loadList(this.page,this.pageSize)}});window.Janfish_DataList=a})();